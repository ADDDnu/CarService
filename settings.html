<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <title>Car Service ¬∑ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</title>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" href="logo.png">
  <link rel="stylesheet" href="style.css" />
</head>
<body class="has-tabbar" onload="renderSettings(); mqttConnect();">
  <header>
    <img src="logo.png" alt="Car Service Logo" class="logo">
    <h1>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</h1>
  </header>

  <main>
    <!-- MQTT Config -->
    <div class="stat-card">
      <div style="flex:1">
        <h3>MQTT</h3>
        <label>WebSocket URL:</label>
        <input type="text" id="cfg_mqtt_url" placeholder="ws://broker:9001" />
        <label>Username:</label>
        <input type="text" id="cfg_mqtt_user" />
        <label>Password:</label>
        <input type="password" id="cfg_mqtt_pass" />
        <div style="margin-top:8px">
          <button onclick="saveSettings(event)">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        </div>
      </div>
    </div>

    <!-- MQTT Status -->
    <div class="stat-card">
      <h3>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ MQTT</h3>
      <p id="mqtt_status" style="font-weight:bold;color:#666;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</p>
    </div>

    <!-- Import / Export -->
    <div class="stat-card">
      <div style="flex:1">
        <h3>‡∏™‡∏≥‡∏£‡∏≠‡∏á/‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡πÑ‡∏ü‡∏•‡πå JSON)</h3>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button type="button" onclick="exportData()">‚¨ÜÔ∏è Export (.json)</button>
          <label class="badge" style="cursor:pointer">
            ‚¨áÔ∏è Import (.json)
            <input type="file" id="import_file" accept="application/json" style="display:none">
          </label>
        </div>
        <p style="font-size:12px;color:#666;margin-top:8px">
          * Export ‡∏à‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå <b>car_data_backup.json</b><br>
          * Import ‡πÉ‡∏ä‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå JSON
        </p>
      </div>
    </div>

    <!-- (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ Google Drive / ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏≠‡∏∑‡πà‡∏ô ‡πÉ‡∏´‡πâ‡∏Ñ‡∏á‡∏ö‡∏•‡πá‡∏≠‡∏Å‡πÄ‡∏î‡∏¥‡∏°‡πÑ‡∏ß‡πâ‡∏ï‡πà‡∏≠‡∏à‡∏≤‡∏Å‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ) -->
  </main>

  <!-- Bottom Tab Bar (‡∏Ñ‡∏á‡∏ó‡∏µ‡πà‡∏ó‡∏∏‡∏Å‡∏´‡∏ô‡πâ‡∏≤) -->
  <div id="tabbar">
    <nav class="tabbar">
      <a href="index.html"><span class="icon">üè†</span><span>‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</span></a>
      <a href="cars.html"><span class="icon">üöó</span><span>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ñ</span></a>
      <a href="add.html"><span class="icon">üìù</span><span>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</span></a>
      <a href="settings.html" class="active"><span class="icon">‚öôÔ∏è</span><span>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</span></a>
    </nav>
  </div>

  <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
  <script src="mqtt.js"></script>
  <script src="app.js"></script>
  <script>
    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ MQTT ‡∏ó‡∏∏‡∏Å ‡πÜ 1.2 ‡∏ß‡∏¥
    setInterval(() => {
      const el = document.getElementById('mqtt_status');
      if (!el) return;
      if (typeof mqttIsConnected === 'function' && mqttIsConnected()) {
        el.textContent = "‚úÖ Connected";
        el.style.color = "green";
      } else {
        el.textContent = "‚ùå Disconnected";
        el.style.color = "red";
      }
    }, 1200);
  </script>
</body>
</html>
